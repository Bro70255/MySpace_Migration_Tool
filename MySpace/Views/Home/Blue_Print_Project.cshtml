@{
    ViewData["Title"] = "Blue print Project";
}

<div class="blueprint-flow">

    <!-- STEP INDICATOR -->
    <div class="flow-steps">
        <div class="step active">1 Upload</div>
        <div class="step">2 Review</div>
        <div class="step">3 Blueprint</div>
    </div>

    <!-- MAIN PANEL -->
    <div class="flow-body glass-body">

        <!-- STEP 1 -->
        <div class="flow-step active" id="step-upload">
            <h3>Upload Screens</h3>

            <div class="upload-zone" id="dropZone">
                <p>Drag & drop folder or images here</p>
                <span>or</span>

                <input type="file"
                       id="fileInput"
                       multiple
                       webkitdirectory
                       hidden
                       onchange="uploadScreenFolder('fileInput', 1)" />

                <button class="modern-btn"
                        onclick="document.getElementById('fileInput').click()">
                    Browse Folder
                </button>
            </div>
        </div>

        <!-- STEP 2 -->
        <div class="flow-step" id="step-review">
            <h3>Uploaded Structure</h3>

            <div class="tree-view" id="treeView"></div>

            <button class="modern-btn" onclick="goStep(1)">
                Review Upload
            </button>


        </div>


        <!-- STEP 3 -->
        <div class="flow-step" id="step-blueprint">
            <h3>Blueprint Workspace</h3>

            <div class="blueprint-canvas">
                <p>Blueprint generation output appears here</p>
            </div>
        </div>

    </div>
</div>

<script>
    const steps = document.querySelectorAll(".flow-step");
     const stepHeaders = document.querySelectorAll(".flow-steps .step");

     function goStep(index) {
         steps.forEach(s => s.classList.remove("active"));
         stepHeaders.forEach(h => h.classList.remove("active"));

         steps[index].classList.add("active");
         stepHeaders[index].classList.add("active");

         // ✅ AUTO LOAD TREE WHEN REVIEW STEP IS OPENED
         if (index === 1) {
             loadOCRTreeView();
         }
     }

     // ✅ MAKE STEPS CLICKABLE
     stepHeaders.forEach((step, index) => {
         step.addEventListener("click", () => {
             goStep(index);
         });
     });

    // Drag & drop highlight
    const dropZone = document.getElementById("dropZone");

    dropZone.addEventListener("dragover", e => {
        e.preventDefault();
        dropZone.style.borderColor = "#60a5fa";
    });

    dropZone.addEventListener("dragleave", () => {
        dropZone.style.borderColor = "#93c5fd";
    });

    dropZone.addEventListener("drop", e => {
        e.preventDefault();
        dropZone.style.borderColor = "#93c5fd";
        document.getElementById("fileInput").files = e.dataTransfer.files;
        uploadScreenFolder("fileInput", 1);
    });
</script>
